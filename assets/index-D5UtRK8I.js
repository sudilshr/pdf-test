(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))i(n);new MutationObserver(n=>{for(const o of n)if(o.type==="childList")for(const s of o.addedNodes)s.tagName==="LINK"&&s.rel==="modulepreload"&&i(s)}).observe(document,{childList:!0,subtree:!0});function t(n){const o={};return n.integrity&&(o.integrity=n.integrity),n.referrerPolicy&&(o.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?o.credentials="include":n.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function i(n){if(n.ep)return;n.ep=!0;const o=t(n);fetch(n.href,o)}})();function $(r,e){var t=r.data,i=r.width,n=r.height,o=[0,0,0],s=20;e.forEach(function(l){for(var h=Math.floor(l.transform[4]),g=Math.round(l.width),p=Math.round(l.height),f=Math.round(n-l.transform[5]),b=f-p,m=(h+b*i)*4,u=[],x=1/0,c=new A,d,y,w=0;w<p;w++){d=m+w*i*4;for(var M=0;M<g;M++)(y=t[d]+t[d+1]+t[d+2])<x&&(x=y,u[0]=t[d],u[1]=t[d+1],u[2]=t[d+2]),c.addPixel(t[d],t[d+1],t[d+2]),d+=4}var O=c.getStdDev();l.color=O<s?o:u})}class A{constructor(){this.pixelCount=0,this.pixels=[],this.rgb=[],this.mean=0,this.stdDev=0}addPixel(e,t,i){this.rgb.length?(this.rgb[0]+=e,this.rgb[1]+=t,this.rgb[2]+=i):(this.rgb[0]=e,this.rgb[1]=t,this.rgb[2]=i),this.pixelCount++,this.pixels.push([e,t,i])}getStdDev(){var e=[this.rgb[0]/this.pixelCount,this.rgb[1]/this.pixelCount,this.rgb[2]/this.pixelCount],t=[0,0,0];return this.pixels.forEach(function(i){t[0]+=Math.pow(e[0]-i[0],2),t[1]+=Math.pow(e[1]-i[1],2),t[2]+=Math.pow(e[2]-i[2],2)}),t[0]=Math.sqrt(t[0]/this.pixelCount),t[1]=Math.sqrt(t[1]/this.pixelCount),t[2]=Math.sqrt(t[2]/this.pixelCount),t[0]+t[1]+t[2]}}const C=document.getElementById("pdf-canvas");C.getContext("2d");const D=document.getElementById("fileInput"),E=document.getElementById("prev-page"),P=document.getElementById("next-page"),R=document.getElementById("page-info");let B=null,a=1,v=0;E.disabled=!0;P.disabled=!0;D.addEventListener("change",r=>{const e=r.target.files[0];e&&e.type==="application/pdf"&&S(e)});window.addEventListener("load",()=>{fetch("hidden-text.pdf").then(r=>r.blob()).then(r=>{const e=new File([r],"hidden-text.pdf",{type:"application/pdf"});S(e)})});function I(){R.textContent=`Page ${a} of ${v}`,E.disabled=a===1,P.disabled=a===v}E.addEventListener("click",()=>{a>1&&(a--,L(a),I())});P.addEventListener("click",()=>{a<v&&(a++,L(a),I())});function S(r){const e=new FileReader;e.onload=function(){const t=new Uint8Array(this.result);pdfjsLib.disableWorker=!0,pdfjsLib.getDocument(t).promise.then(i=>{B=i,v=i.numPages,a=1,I(),L(a)})},e.readAsArrayBuffer(r)}function L(r){B.getPage(r).then(e=>{const t=e.getViewport({scale:1});C.width=t.width,C.height=t.height;const i=document.getElementById("pdf-canvas"),n=i.getContext("2d"),o=document.getElementById("text-canvas"),s=o.getContext("2d"),l={canvasContext:n,viewport:t};e.render(l),e.getTextContent().then(h=>{o.width=t.width,o.height=t.height,s.clearRect(0,0,o.width,o.height),n.strokeStyle="gray",n.lineWidth=2,n.strokeRect(0,0,i.width,i.height),s.strokeStyle="gray",s.lineWidth=2,s.strokeRect(0,0,o.width,o.height);let g=h.items;console.time("color"),$(n.getImageData(0,0,t.width,t.height),h.items),console.timeEnd("color"),console.log(g),g.forEach(f=>{const{str:b,transform:m,width:u,height:x,color:c}=f,d=m[4],y=t.height-m[5];s.font=`${x}px sans-serif`,s.fillStyle=`rgb(${c[0]}, ${c[1]}, ${c[2]})`,s.fillText(b,d,y)});let p="";h.items.forEach(f=>{p+=f.str+`
`})})})}
